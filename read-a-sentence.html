<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Read a sentence - JS LPC Speech Synthesizer</title>
  <link rel="stylesheet" href="css/read-a-sentence/style.css">
</head>
<body>
  <div class="container">
    <select id="dropdown"></select>
    <textarea id="textbox"></textarea>
    <div id="pitchControls" class="pitch-controls"></div>
    <button id="playButton">Read</button>
  </div>
</body>
</html>


<script>
  var pitchTypes = [
    'pitchFirstWord',
    'pitchVerb',
    'pitchNoun',
    'pitchElse',
    'pitchPenultimate',
    'pitchLastWord'
  ];

  var pitchDefaultValues = {
    'pitchFirstWord': 150,
    'pitchVerb': 160,
    'pitchNoun': 160,
    'pitchElse': 150,
    'pitchPenultimate': 140,
    'pitchLastWord': 125
  };

  // Define global pitch variables with default values
  var pitchFirstWord, pitchVerb, pitchNoun, pitchElse, pitchPenultimate, pitchLastWord;


  // build pitch inputs programmatically
  for (let pitchType of pitchTypes) {
    window[pitchType] = pitchDefaultValues[pitchType];
    var pitchControl = document.createElement('div');
    var label = document.createElement('label');
    var minus1Button = document.createElement('button');
    var minus5Button = document.createElement('button');
    var input = document.createElement('input');
    var plus1Button = document.createElement('button');
    var plus5Button = document.createElement('button');

    minus1Button.textContent = '-1';
    minus1Button.onclick = function() { adjustPitch(pitchType, -1); };
    minus5Button.textContent = '-5';
    minus5Button.onclick = function() { adjustPitch(pitchType, -5); };
    input.type = 'number';
    input.id = pitchType;
    input.min = '50';
    input.max = '300';
    input.value = pitchDefaultValues[pitchType];
    input.onchange = function() { updatePitchValue(pitchType, this.value); };
    plus1Button.textContent = '+1';
    plus1Button.onclick = function() { adjustPitch(pitchType, 1); };
    plus5Button.textContent = '+5';
    plus5Button.onclick = function() { adjustPitch(pitchType, 5); };

    // obtain a piece of the label from pitchType like so:
    // "pitchFirstWord" -> "first word"
    // i.e. remove "pitch" and insert a space before each capital letter, and trim and lowercase everything
    var pitchTypeWithoutPitch = pitchType.replace('pitch', '');
    var pitchTypeWithoutPitchAndCapitalLetters = pitchTypeWithoutPitch.replace(/[A-Z]/g, ' $&');
    var pitchTypeWithoutPitchAndCapitalLettersTrimmed = pitchTypeWithoutPitchAndCapitalLetters.trim();
    var pitchTypeWithoutPitchAndCapitalLettersTrimmedLowercased = pitchTypeWithoutPitchAndCapitalLettersTrimmed.toLowerCase();

    label.appendChild(document.createTextNode('Pitch for ' + pitchTypeWithoutPitchAndCapitalLettersTrimmedLowercased + ': '));
    label.appendChild(minus1Button);
    label.appendChild(minus5Button);
    label.appendChild(input);
    label.appendChild(plus1Button);
    label.appendChild(plus5Button);
    pitchControl.appendChild(label);
    document.getElementById('pitchControls').appendChild(pitchControl);
  }


  // Adjust pitch value by a certain increment
  function adjustPitch(pitchType, increment) {
    var currentPitch = window[pitchType];
    var newPitch = currentPitch + increment;
    // Ensure the new pitch is within the allowed range
    newPitch = Math.max(50, Math.min(newPitch, 300));
    window[pitchType] = newPitch;
    // Update the input element's value
    document.getElementById(pitchType).value = newPitch;
    // Trigger the onchange event to update the global variable
    updatePitchValue(pitchType, newPitch);
  }

  // set each of the pitch inputs to the default value of above
  for (let pitchType of pitchTypes) {
    window[pitchType] = document.getElementById(pitchType).value = pitchDefaultValues[pitchType];
  }

  // Update global pitch variables when pitch controls change
  function updatePitchValue(pitchType, newValue) {
    window[pitchType] = parseInt(newValue, 10);
  }

  var lpcModelData = null; // filled by the testLPCData.js script
  var availableWords = null;
</script>

<script src="speechAudio/available-words.js"></script>
<script src="speechAudio/json-js/as.mp3.LPC.json.js"></script>

<script>
  var asModelData = lpcModelData;
  var lpcModelData = null;
</script>
  

<script src="js/RosenbergModelGlottalPulseGenerator.js"></script>
<script src="js/LPCtoPCMSignalConverter.js"></script>
<script src="js/CarrierSignalGenerator.js"></script>
<script src="js/AspirationGenerator.js"></script>

<script src="js/audioBufferToWavBlob.js"></script>
<script src="js/BasicWaveformPlot.js"></script>

<script src="js/read-a-sentence/JobQueue.js"></script>
<script src="js/read-a-sentence/Job.js"></script>
<script src="js/read-a-sentence/LoadWordDataJob.js"></script>
<script src="js/read-a-sentence/BuildPCMJob.js"></script>

<script>
  // this one loads "as" and uses its last part as the "s" of plurals (the plurals that end with s, that is)
  let pitch = 150;
  let sampleRate = 1 / asModelData.samplingPeriod;
  let carrierSignalGenerator = new CarrierSignalGenerator(pitch, sampleRate);
  let pcmSignalBuilder = new LPCtoPCMSignalConverter();
  var asPCMSignal= pcmSignalBuilder.build(asModelData, pitch, false, carrierSignalGenerator);
  let numberOfSamplesToAppend = 2700;
  let sSignal = asPCMSignal.slice(-numberOfSamplesToAppend);
  delete asPCMSignal;
</script>

<script src="js/read-a-sentence/libs/compromise-14.10.0/compromise-two.js "></script>
<script src="js/read-a-sentence/read-a-sentence.js"></script>
